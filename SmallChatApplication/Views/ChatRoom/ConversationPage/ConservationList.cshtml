@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}
<style>


    /* Search bar rules */
    .search-bar-container {
        /* Define vairable for search bar */
        --search-bar-height: 10vh;
        --container-list-container: calc(99vh - var(--search-bar-height));
        height: var(--search-bar-height);
        padding: 10px;
        border-bottom: 1px solid black;
    }

        .search-bar-container input {
            padding: 5px;
            margin-right: 0.5rem;
        }

        .search-bar-container .search-bar-btn-container {
            width: 5rem;
        }

        .search-bar-container .btn-close-search-list,
        .search-bar-container .btn-add-friend,
        .search-bar-container .btn-create-group {
            padding: 0rem 0.5rem;
            font-weight: bold;
        }

        .search-bar-container .search-bar-icon {
            width: 1rem;
        }

        .search-bar-container .btn-close-search-list {
            display: none;
        }

    /* Conversation rules */
    .conversations-list-container {
        height: var(--container-list-container);
        overflow: auto;
    }

    .conversation {
        height: 4rem;
        cursor: pointer;
        transition: background-color 0.15s ease-in-out;
    }

        .conversation:hover {
            background-color: #F3F5F6;
        }

        .conversation.active {
            background-color: #E5EFFF;
        }

    .conversation-avatar > img {
        width: 50px;
        padding: 10px;
    }

    .conversation-last-message {
        color: #788BA4;
        /* Truncate long text */
        width: 14.5rem;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .conversation-description {
        padding-left: 0.5rem;
    }
</style>

<div class="search-bar-container">
    <div class="search-input-container d-flex">
        <input type="text" class="search-bar-input form-control" placeholder="Tìm kiếm" />
        <div class="search-bar-btn-container d-flex">
            <button class="btn btn-add-friend">
                <img class="search-bar-icon" src="~/img/add-user.png" />
            </button>
            <button class="btn btn-create-group">
                <img class="search-bar-icon" src="~/img/add-user.png" />
            </button>
        </div>
    </div>
</div>

<div class="conversations-list-container ">
    @*     <div class="conversation active d-flex">
    <div class="conversation-avatar">
    <img src="~/img/user.png" />
    </div>
    <div class="conversation-description">
    <div class="conversation-name">
    Group 2
    </div>
    <div class="conversation-last-message">
    You: Hello world lllllldasfasgjhasjgkhsagjsllllllllllll
    </div>
    </div>
    </div> *@
</div>

<script>
    //Search-bar script
    $(document).ready(function () {
        const INFO_POPUP_CONTAINER = $(".info-pop-up-container");
        let container = $(".search-bar-container");
        let btnAddUser = container.find(".btn-add-friend");
        let btnCreateGroup = container.find(".btn-create-group");
        let searchBarInput = container.find(".search-bar-input");


        $(btnAddUser).click(function () {
            let searchValue = $(searchBarInput).val();
            // Fix later
            $.ajax({
                url: BASE_ADDRESS + "/api/Users/Search/" + searchValue,
                dataType: 'json',
                type: 'GET',
                contentType: 'application/json',
                success: function (data, textStatus, jQxhr) {

                    //User json format
                    /*
                        "userId": 1,
                        "phoneNumber": "",
                        "password": "",
                        "name": "",
                        "dob": "",
                        "gender": "Nam"
                        "avatarUrl": "",
                        "backgroundUrl": "",
                        "introduction": "fix bug :(",
                        "email": "",
                        "active": true,
                        "groupGroupDeputies": [],
                        "groupGroupLeaders": [],
                        "messages": []
                    */
                    let userType = "Stranger";
                    if (data.userId === user.userId) {
                        userType = "Self";
                    }
                    for (let friendObject of friendList) {
                        if (friendObject.userId === data.userId) {
                            userType = "Friend";
                        }
                    }

                    ChatApplicationNamespace.LoadInfoPopupData(data, userType);
                    $(INFO_POPUP_CONTAINER).show();
                },
                error: function (jqXhr, textStatus, errorThrown) {
                    console.log(errorThrown);
                }
            });
        });
    });
</script>


@* Load data dynamically *@
<script>
    $(document).ready(function () {
        const CONVERSATION_LIST_CONTAINER = $(".conversations-list-container");

        let user = {
            id: 1,
            name: "Đứca",
            gender: "Nam",
            DoB: "10-02-2003",
            phoneNumber: "+84123",
            backgroundImgURL: "https://carwow-uk-wp-3.imgix.net/18015-MC20BluInfinito-scaled-e1666008987698.jpg",
            avatarURL: "https://static2-images.vnncdn.net/files/publish/2022/12/8/meo-1-1416.jpg",
        };

        let group = {
            id: 1,
            name: 'Bàn chuyện linh tinh',
            leaderId: 1,
            deputyId: 1,
            avatarUrl: "https://xwatch.vn/upload_images/images/2023/05/22/anh-meme-la-gi.jpg",
            inviteUrl: ""
        };
        let message = {
            id: 1,
            senderId: 1,
            content: "Ê đi chơi ko ae ? Hẹn tối nay 7h hé!",
            messageType: "text",
            active: true
        }

        let group2 = {
            id: 2,
            name: 'Công việc',
            leaderId: 2,
            deputyId: 2,
            avatarUrl: "https://info.totalwellnesshealth.com/hs-fs/hubfs/Relax-2.png",
            inviteUrl: ""
        };

        let message2 = {
            id: 2,
            senderId: 1,
            content: "Cuộc họp này rất quan trọng!",
            messageType: "text",
            active: true
        }

        renderConversation(group, user, message);
        renderConversation(group2, user, message2);


        function renderConversation(groupObject, userObject, messageObject) {
            //Struture of a conversation

            // <div class="conversations-list-container ">
            //     <div class="conversation active d-flex">
            //         <div class="conversation-avatar">
            //             <img src="~/img/user.png" />
            //         </div>
            //         <div class="conversation-description">
            //             <div class="conversation-name">
            //                 Group 2
            //             </div>
            //             <div class="conversation-last-message">
            //                 You: Hello world lllllldasfasgjhasjgkhsagjsllllllllllll
            //             </div>
            //         </div>
            //     </div>
            // </div>

            let conversationDiv = document.createElement("div");
            conversationDiv.className = "conversation d-flex";
            CONVERSATION_LIST_CONTAINER.append(conversationDiv);

            // Creating avatar
            let conversationAvatarDiv = document.createElement("div");
            conversationAvatarDiv.className = "conversation-avatar";
            let avatarImage = document.createElement("img");
            avatarImage.src = groupObject.avatarUrl;
            conversationAvatarDiv.append(avatarImage);

            //Create description
            let conversationDescriptionDiv = document.createElement("div");
            conversationDescriptionDiv.className = "conversation-description";

            let conversationNameDiv = document.createElement("div");
            conversationNameDiv.className = "conversation-name";
            conversationNameDiv.textContent = groupObject.name;

            //Create last message
            let converstationLastMessageDiv = document.createElement("div");
            converstationLastMessageDiv.className = "conversation-last-message";
            converstationLastMessageDiv.textContent = `You: ${messageObject.content}`;

            conversationDescriptionDiv.append(conversationNameDiv);
            conversationDescriptionDiv.append(converstationLastMessageDiv);

            conversationDiv.append(conversationAvatarDiv);
            conversationDiv.append(conversationDescriptionDiv);
        }
    })
</script>
<script>
    // Conservation list script
    $(document).ready(function () {
        const CONVERSATION_LIST_CONTAINER = $(".conversations-list-container");

        let conversations = CONVERSATION_LIST_CONTAINER.find(".conversation");
        conversations.each(function () {
            $(this).click(function () {
                disableAllConversations();
                activateConversation($(this));
            });
        });

        function disableAllConversations() {
            conversations.each(function () {
                if ($(this).hasClass("active")) {
                    $(this).removeClass("active");
                }
            })
        }
        function activateConversation(conversationDiv) {
            conversationDiv.addClass("active");
        }
    });
</script>
